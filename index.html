<html>
 <head>
  <title>HTML Pad Preview</title>
  <link rel="stylesheet" href="style.css" type="text/css"/>
  <script type="text/javascript" src="jquery-1.10.2.js"></script>
 </head>
 <body>
  <p id="head">
   Source:
   <span id="url"></span>
   <input type="button" onclick="loadPad();" value="Refresh"></input> 
  </p>
  <div id="preview"></div>
 </body>
 <script type="text/javascript">
var loadPad = function(){
 var padUrl = window.location.search.substring(1)
     htmlUrl = padUrl + "/export/html",
     commentW = (window.innerWidth - $('body').innerWidth())/2;
 if (padUrl) {
  $("#url").html('<a target="_blank" href="'+padUrl+'">'+padUrl+"</a>");
  if (padUrl.search("/p/") == -1)
   htmlUrl = padUrl.replace(/\/([^\/]*)$/, "/ep/pad/export/$1/latest?format=html");
  $.get(
   htmlUrl,
   function(data){
    data = data.replace(/\n/g, "")
     .replace(/^.*<body>/, "")
     .replace(/<\/body>.*$/, "")
     .replace(/(<br>|\s)*<em>([^<]+)<\/em>(<br>|\s)*/g, ' &lt;em class="comment"&gt;$2&lt;/em&gt;')
     .replace(/(p|div|h\d+)&gt;(<br>|\s)*&lt;(p|div|h\d+)/g, "$1&gt;&lt;$3")
     .replace(/<br>/g, "&lt;br/&gt;")
     .replace(/<[^>]*>/g, "")
     .replace(/&lt;/g, "<")
     .replace(/&gt;/g, ">")
     .replace(/&#x2F;/g, "/")
     .replace(/&quot;/g, '"')
     .replace(/&amp;/g, "&");
    $("#preview").html(data);
    $(".comment").map(function(i,c){
     $(c).attr("style",
        "position: absolute;" +
        (i % 2 == 0 ? "righ" : "lef")+"t: "+Math.floor(0.1*commentW)+";" +
        "display: inline;" +
        "background-color: #FD7;" +
        "border-radius: 8px;" +
        "padding: 5px;" +
        "width: "+Math.floor(0.8*commentW)+"px;" +
        "z-index: -1;"
     );
    });
   },
   "html"
  );
 }
};
$(document).ready(loadPad);
 </script>
</html>
